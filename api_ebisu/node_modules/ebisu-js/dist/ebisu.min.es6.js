'use strict';(function(m){"object"===typeof exports&&"undefined"!==typeof module?module.exports=m():"function"===typeof define&&define.amd?define([],m):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).ebisu=m()})(function(){return function(){function m(k,p,e){function h(a,c){if(!p[a]){if(!k[a]){var d="function"==typeof require&&require;if(!c&&d)return d(a,!0);if(b)return b(a,!0);c=Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",
c;}c=p[a]={exports:{}};k[a][0].call(c.exports,function(b){return h(k[a][1][b]||b)},c,c.exports,m,k,p,e)}return p[a].exports}for(var b="function"==typeof require&&require,d=0;d<e.length;d++)h(e[d]);return h}return m}()({1:[function(m,k,p){function e(a){let b=q.get(a);if(b)return b;b=n(a);q.set(a,b);return b}function h(a,b){return e(a)+e(b)-e(a+b)}function b(b,c,f,e,n=!0,g){const [u,t,q]=b;g=g||q;const m=e/q,k=g/e,w=Array.from(Array(f-c+1),(a,b)=>{a=f-c;return-h(1+a-b,1+b)-Math.log(a+1)}),[r,v,p]=[0,
1,2].map(a=>{const b=Array.from(Array(f-c+1),(b,f)=>w[f]+h(t,u+m*(c+f)+a*m*k)),d=Array.from(Array(f-c+1),(a,b)=>Math.pow(-1,b));return l(b,d)[0]}),x=Math.exp(v-r),y=Math.exp(p-r),z=y-Math.exp(2*(v-r));if(![x,y,z].every(b=>isFinite(b)&&0<=b))throw Error(JSON.stringify({prior:b,successes:c,total:f,tnow:e,rebalance:n,tback:g,mean:x,m2:y,sig2:z}));const [A,B]=a(x,z);g=[A,B,g];return n?d(b,c,f,e,g):g}function d(a,f,d,e,g){const [u,h]=g;return u>2*h||h>2*u?(g=c(g,.5,!0),b(a,f,d,e,!1,g)):g}function a(b,
a){a=b*(1-b)/a-1;return[b*a,(1-b)*a]}function c(b,a=.5,c=!1,d=1E-4){function e(a){return h(n+f(a),l)-q-k}if(0>a||1<a)throw Error("percentiles must be between (0, 1) exclusive");const [n,l,u]=b,q=h(n,l),k=g(a),p=c?1:6;b=-p/2;a=p/2;let r=e(b),t=e(a);for(;0<r&&0<t;)b=a,r=t,a+=p,t=e(a);for(;0>r&&0>t;)a=b,t=r,b-=p,r=e(b);if(!(0<r&&0>t))throw Error("failed to bracket");if(c)return(f(b)+f(a))/2*u;c={};d=m("minimize-golden-section-1d")(a=>Math.abs(e(a)),{lowerBound:b,upperBound:a,tolerance:d},c);if(!c.converged)throw Error("failed to converge");
return f(d)*u}var n=m("gamma").log;const l=m("./logsumexp"),f=Math.exp,g=Math.log,q=new Map;k.exports={updateRecall:b,predictRecall:function(a,b,c=!1){const [d,g,h]=a;a=d+b/h;a=n(a)-n(a+g)+e(d+g)-e(d);return c?f(a):a},defaultModel:function(a,b=4,c=b){return[b,c,a]},modelToPercentileDecay:c}},{"./logsumexp":2,gamma:3,"minimize-golden-section-1d":4}],2:[function(m,k,p){var e=Math.exp,h=Math.log,b=Math.sign,d=Math.max;k.exports=function(a,c){var n=d(...a),l=0;for(let b=a.length-1;0<=b;b--)l+=c[b]*e(a[b]-
n);a=b(l);return[h(l*a)+n,a]}},{}],3:[function(m,k,p){function e(d){if(0>d)return Number("0/0");for(var a=b[0],c=b.length-1;0<c;--c)a+=b[c]/(d+c);c=d+4.7421875+.5;return.5*Math.log(2*Math.PI)+(d+.5)*Math.log(c)-c+Math.log(a)-Math.log(d)}var h=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9.984369578019572E-6,1.5056327351493116E-7],b=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,
3.399464998481189E-5,4.652362892704858E-5,-9.837447530487956E-5,1.580887032249125E-4,-2.1026444172410488E-4,2.1743961811521265E-4,-1.643181065367639E-4,8.441822398385275E-5,-2.6190838401581408E-5,3.6899182659531625E-6];k.exports=function c(a){if(.5>a)return Math.PI/(Math.sin(Math.PI*a)*c(1-a));if(100<a)return Math.exp(e(a));--a;for(var b=h[0],l=1;9>l;l++)b+=h[l]/(a+l);l=a+7+.5;return Math.sqrt(2*Math.PI)*Math.pow(l,a+.5)*Math.exp(-l)*b};k.exports.log=e},{}],4:[function(m,k,p){var e=m("./src/golden-section-minimize"),
h=m("./src/bracket-minimum"),b=[0,0];k.exports=function(d,a,c){a=a||{};var n=void 0===a.tolerance?1E-8:a.tolerance,l=void 0===a.initialIncrement?1:a.initialIncrement,f=void 0===a.lowerBound?-Infinity:a.lowerBound,g=void 0===a.upperBound?Infinity:a.upperBound,q=void 0===a.maxIterations?100:a.maxIterations;c&&(c.iterations=0,c.argmin=NaN,c.minimum=Infinity,c.converged=!1);if(isFinite(g)&&isFinite(f))b[0]=f,b[1]=g;else if(a=void 0===a.guess?-Infinity<f?Infinity>g?.5*(f+g):f:Infinity>g?g:0:a.guess,h(b,
d,a,l,f,g,q),isNaN(b[0])||isNaN(b[1]))return NaN;return e(d,b[0],b[1],n,q,c)}},{"./src/bracket-minimum":5,"./src/golden-section-minimize":6}],5:[function(m,k,p){k.exports=function(e,h,b,d,a,c,n){var l,f,g;n=1;var q=g=b;for(f=l=b=h(b);!k&&isFinite(d)&&!isNaN(d);){++n;var k=!0;l<=f&&(f=l,g=Math.max(a,g-d),l=h(g),k=!1);b<=f&&(f=b,q=Math.min(c,q+d),b=h(q),k=!1);f=Math.min(f,l,b);if(l===f&&g===a||b===f&&q===c)k=!0;d*=4>n?2:Math.exp(.5*n);if(!isFinite(d))return e[0]=-Infinity,e[1]=Infinity,e}e[0]=g;e[1]=
q;return e}},{}],6:[function(m,k,p){var e=2/(1+Math.sqrt(5));k.exports=function(h,b,d,a,c,n){for(var l=0,f=d-e*(d-b),g=b+e*(d-b),k=h(f),m=h(g),p=h(b),r=h(d),v=b,w=d;++l<c&&Math.abs(d-b)>a;)m>k?(d=g,g=f,m=k,f=d-e*(d-b),k=h(f)):(b=f,f=g,k=m,g=b+e*(d-b),m=h(g));h=.5*(d+b);b=.5*(k+m);n&&(n.iterations=l,n.argmin=h,n.minimum=b,n.converged=!0);return isNaN(m)||isNaN(k)||l===c?(n&&(n.converged=!1),NaN):p<b?v:r<b?w:h}},{}]},{},[1])(1)});
